{"version":3,"sources":["../../js/containers/Auth.js"],"names":["INITIAL_STATE","uid","isAnonymous","Auth","state","handleSignIn","userManager","context","oidc","getUser","then","user","signIn","catch","console","log","signinPopup","handleSignOut","signoutPopup","pydio","loadXmlRegistry","events","addUserLoaded","loadedUser","id_token","expires_at","PydioApi","JWT_DATA","jwt","expirationTime","setState","idToken","isAuthed","props","children","bind","signOut","React","Component","propTypes","PropTypes","func","isRequired","contextTypes","object"],"mappings":";;;;;;;;;;AAAA;;;;AACA;;;;;;;;;;;;AAEA,IAAMA,gBAAgB;AACpBC,SAAK,EADe;AAEpBC,iBAAa;AACb;AACA;AACA;AACA;AANoB,CAAtB;;IASMC,I;;;;;;;;;;;;;;sLASJC,K,GAAQJ,a,QASRK,Y,GAAe,oBAAY;AAAA,gBACfC,WADe,GACC,MAAKC,OAAL,CAAaC,IADd,CACfF,WADe;;;AAIvBA,wBAAYG,OAAZ,GACGC,IADH,CACQ,UAACC,IAAD,EAAU;AACZ,oBAAI,CAACA,IAAL,EAAW;AACP,0BAAM,gBAAN;AACH;;AAED,sBAAKC,MAAL,CAAYD,IAAZ;AACH,aAPH,EAQGE,KARH,CAQS,YAAM;AACTC,wBAAQC,GAAR,CAAY,cAAZ;AACAT,4BAAYU,WAAZ;AACH,aAXH;AAYH,S,QAEDC,a,GAAgB,YAAM;AAAA,gBACZX,WADY,GACI,MAAKC,OAAL,CAAaC,IADjB,CACZF,WADY;;;AAGpBA,wBAAYY,YAAZ;;AAEAC,kBAAMC,eAAN;AACD,S;;;;;4CA/BmB;AAAA;;AAAA,gBACRd,WADQ,GACQ,KAAKC,OAAL,CAAaC,IADrB,CACRF,WADQ;;;AAGhBA,wBAAYe,MAAZ,CAAmBC,aAAnB,CAAiC,UAACC,UAAD;AAAA,uBAAgB,OAAKX,MAAL,CAAYW,UAAZ,CAAhB;AAAA,aAAjC;AACH;;;+BA6BMZ,I,EAAM;AAAA,gBACHa,QADG,GACsBb,IADtB,CACHa,QADG;AAAA,gBACOC,UADP,GACsBd,IADtB,CACOc,UADP;;;AAGXC,qBAASC,QAAT,GAAoB;AACfC,qBAAKJ,QADU;AAEfK,gCAAgBJ;AAFD,aAApB;;AAKAN,kBAAMC,eAAN;;AAEA,iBAAKU,QAAL,CAAc;AACZC,yBAASP;AADG,aAAd;AAGD;;;kCAES;AACN,iBAAKM,QAAL,CAAc9B,aAAd;AACH;;;iCAEQ;AACL,gBAAMgC,WAAW,CAAC,CAAC,KAAK5B,KAAL,CAAW2B,OAA9B;AACA,mBAAO,KAAKE,KAAL,CAAWC,QAAX,cACA,KAAK9B,KADL;AAEHQ,wBAAQ,KAAKP,YAAL,CAAkB8B,IAAlB,CAAuB,IAAvB,CAFL;AAGHC,yBAAS,KAAKnB,aAAL,CAAmBkB,IAAnB,CAAwB,IAAxB,CAHN;AAIHH;AAJG,eAAP;AAMH;;;;EAvEgBK,gBAAMC,S;;AAAnBnC,I,CACGoC,S,GAAY;AACjBL,cAAUM,oBAAUC,IAAV,CAAeC;AADR,C;AADfvC,I,CAKGwC,Y,GAAe;AAClBnC,UAAMgC,oBAAUI;AADE,C;kBAqETzC,I","file":"Auth.js","sourcesContent":["import React from 'react';\nimport PropTypes from 'prop-types';\n\nconst INITIAL_STATE = {\n  uid: '',\n  isAnonymous: null,\n  // // some other properties from the user object that may be useful\n  // email: '',\n  // displayName: '',\n  // photoURL: '',\n};\n\nclass Auth extends React.Component {\n  static propTypes = {\n    children: PropTypes.func.isRequired,\n  };\n\n  static contextTypes = {\n      oidc: PropTypes.object,\n  };\n\n  state = INITIAL_STATE;\n\n  componentDidMount() {\n      const { userManager } = this.context.oidc;\n\n      userManager.events.addUserLoaded((loadedUser) => this.signIn(loadedUser));\n  }\n\n\n  handleSignIn = provider => {\n      const { userManager } = this.context.oidc;\n\n\n      userManager.getUser()\n        .then((user) => {\n            if (!user) {\n                throw \"User not found\"\n            }\n\n            this.signIn(user)\n        })\n        .catch(() => {\n            console.log(\"Signin popup\")\n            userManager.signinPopup()\n        });\n  };\n\n  handleSignOut = () => {\n    const { userManager } = this.context.oidc;\n\n    userManager.signoutPopup();\n\n    pydio.loadXmlRegistry();\n  };\n\n  signIn(user) {\n    const { id_token, expires_at } = user;\n\n    PydioApi.JWT_DATA = {\n         jwt: id_token,\n         expirationTime: expires_at\n    };\n\n    pydio.loadXmlRegistry();\n\n    this.setState({\n      idToken: id_token,\n    });\n  }\n\n  signOut() {\n      this.setState(INITIAL_STATE);\n  }\n\n  render() {\n      const isAuthed = !!this.state.idToken;\n      return this.props.children({\n          ...this.state,\n          signIn: this.handleSignIn.bind(this),\n          signOut: this.handleSignOut.bind(this),\n          isAuthed,\n      });\n  }\n}\n\nexport default Auth;\n"]}